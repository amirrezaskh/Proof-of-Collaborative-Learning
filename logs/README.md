# Logs

This directory contains log files generated by all components of the Proof of Collaborative Learning (PoCL) system. These logs provide real-time monitoring, debugging information, and audit trails for the federated learning consensus process.

## Overview

The logs directory captures output from:
- **Express Applications**: API gateway and coordination services
- **Miners**: Federated learning participants and their training processes
- **Aggregator**: Model aggregation and reward calculation service
- **Submitter**: Transaction generation service

## Log Files

### Express Applications
- **`app1.txt`** - Primary admin application logs (Port 3000)
- **`app2.txt`** - Secondary application logs (Port 3001)

### Miners
- **`miner1.txt`** through **`miner10.txt`** - Individual miner logs
  - Training progress and metrics
  - Model submission confirmations
  - Prediction and voting activities
  - Network communication status

### System Services
- **`aggregator.txt`** - Model aggregation service logs
- **`submitter.txt`** - Transaction submission service logs

## Log Content Overview

### Express Application Logs (app1.txt, app2.txt)
```
Server is listening on localhost:3000.

*** ROUND 1 STARTED ***
Miners are notified to gather transactions and train local models.
Demo transactions are reset.
All models, predictions, and votes are deleted.
Miners are notified to predict test data records.
Miners are notified to vote the predictions.
Winners of the current round are : ["miner_3","miner_1","miner_7","miner_2","miner_5"]
The global model is updates and rewards are distributed.
*** ROUND 1 COMPLETED ***
```

### Miner Logs (miner1.txt - miner10.txt)
```
Starting round 1

Epoch 1 completed.
Epoch 2 completed.
...
Local model is trained.

My vote is ["model_3", "model_1", "model_7", "model_2", "model_4", ...].

miner_1 : Accuracy: 0.84, Reward: 12.5
```

### Aggregator Logs (aggregator.txt)
```
miner_3 : 15.2341
miner_1 : 12.7856
miner_7 : 11.3421
miner_2 : 10.9876
miner_5 : 9.8765
Global model is successfully updated.
```

### Submitter Logs (submitter.txt)
```
Transaction demo_0 submitted.
Transaction demo_1 submitted.
Transaction demo_2 submitted.
...
```

## Log Analysis

### Key Metrics to Monitor

#### Round Progress
- Round start/completion notifications
- Phase transitions (training → prediction → voting → aggregation)
- Winner selection results
- Model aggregation confirmations

#### Training Performance
- Epoch completion rates
- Model convergence patterns
- Training time variations across miners
- Early stopping triggers

#### Consensus Health
- Voting participation rates
- Winner consistency across rounds
- Prediction accuracy distributions
- Reward allocation patterns

#### System Performance
- Transaction submission rates
- API response times
- Network communication delays
- Error frequencies and types

## Monitoring Commands

### Real-time Monitoring
```bash
# Monitor all logs simultaneously
tail -f logs/*.txt

# Monitor specific component
tail -f logs/app1.txt

# Monitor miner activities
tail -f logs/miner*.txt

# Monitor system services
tail -f logs/aggregator.txt logs/submitter.txt
```

### Log Analysis
```bash
# Check for errors across all logs
grep -i error logs/*.txt

# Monitor round completion
grep "ROUND.*COMPLETED" logs/app1.txt

# Check winner patterns
grep "Winners of the current round" logs/app1.txt

# Monitor training progress
grep "Epoch.*completed" logs/miner*.txt

# Check reward distribution
grep "miner_.*:" logs/aggregator.txt
```

## Log Rotation and Management

### Automatic Cleanup
Logs are regenerated each time the system starts:
```python
# In run.py - logs are redirected and overwritten
executor.submit(os.system, "node ./app1.js > ../logs/app1.txt")
executor.submit(os.system, "python3 ./miner1.py > ../../logs/miner1.txt")
```

### Manual Management
```bash
# Archive old logs
mkdir logs/archive/$(date +%Y%m%d_%H%M%S)
mv logs/*.txt logs/archive/$(date +%Y%m%d_%H%M%S)/

# Clear all logs
rm logs/*.txt

# Monitor log sizes
du -sh logs/*.txt
```

## Debugging Common Issues

### Network Startup Issues
Check app1.txt and app2.txt for:
- Blockchain connection errors
- Certificate authentication failures
- Port binding conflicts
- Chaincode deployment errors

### Miner Problems
Check individual miner logs for:
- Training convergence issues
- Model loading/saving errors
- Network communication timeouts
- Data preprocessing problems

### Consensus Issues
Monitor across multiple logs for:
- Incomplete voting rounds
- Model aggregation failures
- Reward calculation errors
- Winner selection anomalies

### Performance Bottlenecks
Analyze logs for:
- Slow training epochs
- Network communication delays
- Memory/resource constraints
- Timeout occurrences

## Log Format Patterns

### Timestamp Patterns
Most logs include implicit timestamps from the system output redirection.

### Error Patterns
```bash
# Common error patterns to search for
grep -E "(error|Error|ERROR|failed|Failed|timeout|Timeout)" logs/*.txt
```

### Success Patterns
```bash
# Monitor successful operations
grep -E "(completed|success|successfully|updated|distributed)" logs/*.txt
```

## Integration with Monitoring Tools

### External Log Aggregation
For production deployment, consider integrating with:
- **ELK Stack**: Elasticsearch, Logstash, Kibana
- **Splunk**: Enterprise log management
- **Grafana + Loki**: Metrics and log visualization
- **Prometheus**: Metrics collection and alerting

### Custom Monitoring Scripts
```bash
#!/bin/bash
# monitor_pocl.sh - Custom monitoring script

# Check if all miners are active
for i in {1..10}; do
    if tail -1 logs/miner$i.txt | grep -q "completed\|vote\|training"; then
        echo "Miner $i: Active"
    else
        echo "Miner $i: Inactive or Error"
    fi
done

# Check latest round status
echo "Latest round: $(grep "ROUND.*STARTED" logs/app1.txt | tail -1)"
echo "Latest winners: $(grep "Winners of the current round" logs/app1.txt | tail -1)"
```

## Performance Analysis

### Training Metrics
Extract training performance data:
```bash
# Collect epoch completion times
grep "Epoch.*completed" logs/miner*.txt | \
    awk '{print $1, $2, $3}' > training_metrics.csv

# Analyze reward distribution
grep "miner_.*:" logs/aggregator.txt | \
    awk '{print $1, $3}' > rewards.csv
```

### Network Performance
Monitor communication efficiency:
```bash
# Check API response patterns
grep -E "POST|GET" logs/app*.txt | wc -l

# Monitor transaction submission rate
grep "Transaction.*submitted" logs/submitter.txt | wc -l
```

## Security and Audit

### Audit Trail
The logs provide a complete audit trail of:
- All training rounds and outcomes
- Winner selection decisions
- Reward distributions
- Transaction processing
- Voting patterns

### Security Monitoring
Monitor for suspicious patterns:
```bash
# Check for unusual voting patterns
grep "My vote is" logs/miner*.txt | sort | uniq -c

# Monitor failed operations
grep -i "failed\|error" logs/*.txt

# Check for timing anomalies
grep "deadline\|timeout" logs/*.txt
```

## Troubleshooting Guide

### No Logs Generated
- Check file permissions in logs directory
- Verify run.py script execution
- Confirm process startup commands

### Incomplete Logs
- Check for process crashes or early termination
- Monitor system resources (memory, CPU)
- Verify network connectivity

### Performance Issues
- Monitor log file sizes for excessive output
- Check for repetitive error messages
- Analyze training convergence patterns

### Log Analysis Tools
```bash
# Count log entries per component
wc -l logs/*.txt

# Find most recent activity
ls -lt logs/*.txt

# Check log sizes
du -sh logs/*.txt | sort -h
```
